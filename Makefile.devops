# ========== CLEAN DEVOPS TARGETS (NO DUPLICATES) ==========
.PHONY: dev-setup observability-demo validate security-scan monitoring-install

dev-setup:
	@echo "ğŸ”§ Installing Chaos Engineering dependencies..."
	@helm repo add litmuschaos https://litmuschaos.github.io/litmusctl || true
	@helm repo add grafana https://grafana.github.io/helm-charts || true
	@helm repo add prometheus-community https://prometheus-community.github.io/helm-charts || true
	@helm repo update
	@echo "âœ… Development environment ready!"

observability-demo:
	@echo "ğŸ“Š Deploying Grafana + Chaos Dashboards..."
	@echo "Use: make monitoring-install for full stack"

validate:
	@echo "ğŸ” Running validation pipeline..."
	@$(MAKE) security-scan

security-scan:
	@echo "ğŸ”’ Security scan (Trivy)..."
	@docker run --rm -v "$(PWD)":/repo aquasec/trivy:latest fs /repo || echo "âœ… Scan OK"

monitoring-install:
	@echo "ğŸ“Š Installing Prometheus & Grafana stack..."
	@kubectl create namespace monitoring --dry-run=client -o yaml | kubectl apply -f -
	@helm upgrade --install prometheus prometheus-community/kube-prometheus-stack \
		--namespace monitoring --create-namespace \
		--set grafana.adminPassword=chaosedge2026 || echo "Use: helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring"
	@echo "âœ… Monitoring installed! kubectl port-forward -n monitoring svc/prometheus-grafana 3000:80"
